# Lighthouse MCP Analysis Capabilities

## 概要

このドキュメントでは、各MCPツールが検出・分析できるパフォーマンス問題と、問題別の推奨ツールをまとめています。

## 目次

1. [L2ツール別の検出可能な問題](#l2ツール別の検出可能な問題)
2. [問題カテゴリー別の推奨ツール](#問題カテゴリー別の推奨ツール)
3. [メトリクス別の分析ツール](#メトリクス別の分析ツール)
4. [統合分析の活用](#統合分析の活用)

---

## L2ツール別の検出可能な問題

### 🔍 l2_deep_analysis
**包括的パフォーマンス分析ツール**

検出可能な問題：
- ✅ Core Web Vitals（LCP, FID, CLS）の問題
- ✅ レンダリングブロッキングリソース
- ✅ 未使用のCSS/JavaScript
- ✅ 大きなJavaScriptバンドル
- ✅ 非効率な画像フォーマット
- ✅ キャッシュポリシーの問題
- ✅ サードパーティスクリプトの影響
- ✅ メインスレッドのブロッキング
- ✅ 長時間実行タスク
- ✅ DOM サイズの問題

計算可能なメトリクス：
- パフォーマンススコア（0-100）
- 各Core Web Vitalsの値
- リソース別の影響度
- 改善による推定削減時間

### 📊 l2_score_analysis
**Lighthouseスコアの詳細分析**

検出可能な問題：
- ✅ スコアを下げている具体的な監査項目
- ✅ 各監査項目の重み付け影響
- ✅ 改善優先度の高い項目
- ✅ カテゴリー別のスコア内訳

計算可能なメトリクス：
- 各監査項目のスコア寄与度
- 重み付けされた影響度
- 改善による推定スコア向上

### ⚖️ l2_weighted_issues
**Lighthouse重み付けによる問題優先順位付け**

検出可能な問題：
- ✅ 重み付けスコアが高い問題
- ✅ 改善効果が大きい項目
- ✅ Quick Win（簡単に改善できる項目）
- ✅ カテゴリー別の問題分布

計算可能なメトリクス：
- 重み付け影響度（weightedImpact）
- カテゴリー別の総影響度
- 改善による推定効果

### 🔗 l2_critical_chain
**クリティカルリクエストチェーン分析**

検出可能な問題：
- ✅ リクエストチェーンのボトルネック
- ✅ 依存関係による遅延
- ✅ 不必要なリダイレクト
- ✅ シリアル化されたリクエスト
- ✅ プリロード可能なリソース

計算可能なメトリクス：
- チェーンの深さ
- 各リクエストの転送サイズ
- チェーン全体の所要時間
- ボトルネックリソースの特定

### 🎯 l2_critical_chain_report
**ボトルネック特化分析**

検出可能な問題：
- ✅ 最もクリティカルなボトルネック
- ✅ チェーン内の遅延原因
- ✅ 並列化可能なリクエスト
- ✅ 優先度の最適化機会

計算可能なメトリクス：
- ボトルネックの影響度スコア
- 改善による推定時間削減
- チェーン最適化の優先順位

### 🗑️ l2_unused_code
**未使用コード検出**

検出可能な問題：
- ✅ 未使用CSS（カバレッジ率）
- ✅ 未使用JavaScript（カバレッジ率）
- ✅ デッドコード
- ✅ ツリーシェイキング可能なコード
- ✅ 分割可能なバンドル

計算可能なメトリクス：
- 未使用バイト数
- カバレッジ率（%）
- ファイル別の未使用割合
- 削減可能なサイズ

### 🌐 l2_third_party_impact
**サードパーティスクリプト影響分析**

検出可能な問題：
- ✅ サードパーティスクリプトのブロッキング時間
- ✅ メインスレッドへの影響
- ✅ ネットワーク帯域の使用
- ✅ 実行時間の長いサードパーティコード

計算可能なメトリクス：
- ブロッキング時間（ms）
- 転送サイズ（bytes）
- メインスレッド占有時間
- ドメイン別の影響度

### 🔄 l2_progressive_third_party
**サードパーティの段階的詳細分析**

検出可能な問題：
- ✅ スクリプト別の詳細な影響
- ✅ 実行順序の最適化機会
- ✅ 遅延読み込み可能なスクリプト
- ✅ 代替ソリューションの提案

計算可能なメトリクス：
- スクリプト別の詳細メトリクス
- 累積影響度
- 最適化による改善予測

### 🖼️ l2_lcp_chain_analysis
**LCP（Largest Contentful Paint）チェーン分析**

検出可能な問題：
- ✅ LCP要素のレンダリング遅延
- ✅ LCPに影響するリソース
- ✅ プリロード可能なLCPリソース
- ✅ LCPを遅らせる依存関係

計算可能なメトリクス：
- LCP値（ms）
- LCPチェーンの長さ
- 各リソースの影響度
- 改善による LCP 削減予測

### 🏢 l2_site_comparison
**複数サイト間のパフォーマンス比較**

検出可能な問題：
- ✅ サイト間のパフォーマンス差
- ✅ ベストプラクティスの欠落
- ✅ 競合サイトとの比較
- ✅ 改善機会の特定

計算可能なメトリクス：
- 比較スコア
- メトリクス別の差分
- 相対的なパフォーマンス順位
- ベンチマーク達成率

---

## 問題カテゴリー別の推奨ツール

### 🚀 ページ読み込み速度の問題

| 問題 | 推奨ツール | 理由 |
|------|-----------|------|
| 遅いLCP | `l2_lcp_chain_analysis` | LCPに特化した分析 |
| レンダリングブロック | `l2_critical_chain` | リクエストチェーン分析 |
| 大きなバンドル | `l2_unused_code` | 未使用コード検出 |
| サードパーティの影響 | `l2_third_party_impact` | サードパーティ特化 |

### 💻 CPU/メインスレッドの問題

| 問題 | 推奨ツール | 理由 |
|------|-----------|------|
| 長時間タスク | `l2_deep_analysis` | メインスレッド分析を含む |
| スタイル再計算 | `l2_deep_analysis` | DOM/CSS問題を検出 |
| JavaScript実行時間 | `l2_unused_code` + `l2_deep_analysis` | 未使用コード削除＋実行分析 |
| TBT（Total Blocking Time） | `l2_deep_analysis` | TBTメトリクスを含む |

### 📦 リソース最適化の問題

| 問題 | 推奨ツール | 理由 |
|------|-----------|------|
| 未使用CSS | `l2_unused_code` | カバレッジ分析 |
| 未使用JavaScript | `l2_unused_code` | カバレッジ分析 |
| 非効率な画像 | `l2_deep_analysis` | 画像最適化提案を含む |
| キャッシュ未設定 | `l2_deep_analysis` | キャッシュ分析を含む |

### 📈 スコア改善

| 目的 | 推奨ツール | 理由 |
|------|-----------|------|
| スコアの内訳確認 | `l2_score_analysis` | 詳細なスコア分析 |
| 改善優先順位 | `l2_weighted_issues` | 重み付けによる優先順位 |
| Quick Win特定 | `l2_weighted_issues` | 簡単な改善項目の特定 |
| 総合的な改善計画 | `l3_action_plan_generator` | 複数ツールの統合分析 |

### 🔄 累積レイアウトシフト（CLS）

| 問題 | 推奨ツール | 理由 |
|------|-----------|------|
| レイアウトシフト要因 | `l2_deep_analysis` | CLS要素の特定 |
| 画像サイズ未指定 | `l2_deep_analysis` | 画像属性の分析 |
| 動的コンテンツ挿入 | `l2_deep_analysis` | DOM変更の検出 |

---

## メトリクス別の分析ツール

### Core Web Vitals

| メトリクス | 主要ツール | 補助ツール |
|-----------|-----------|-----------|
| **LCP** | `l2_lcp_chain_analysis` | `l2_critical_chain`, `l2_deep_analysis` |
| **FID/TBT** | `l2_deep_analysis` | `l2_third_party_impact` |
| **CLS** | `l2_deep_analysis` | `l2_weighted_issues` |

### パフォーマンスメトリクス

| メトリクス | 主要ツール | 補助ツール |
|-----------|-----------|-----------|
| **First Contentful Paint** | `l2_deep_analysis` | `l2_critical_chain` |
| **Speed Index** | `l2_deep_analysis` | `l2_score_analysis` |
| **Time to Interactive** | `l2_deep_analysis` | `l2_third_party_impact` |
| **Total Blocking Time** | `l2_deep_analysis` | `l2_weighted_issues` |

### リソースメトリクス

| メトリクス | 主要ツール | 補助ツール |
|-----------|-----------|-----------|
| **Transfer Size** | `l2_deep_analysis` | `l2_unused_code` |
| **Resource Count** | `l2_critical_chain` | `l2_deep_analysis` |
| **DOM Size** | `l2_deep_analysis` | - |
| **JavaScript Bytes** | `l2_unused_code` | `l2_third_party_impact` |

---

## 統合分析の活用

### L3ツールの役割

#### 🎯 l3_action_plan_generator
**複数L2ツールの結果を統合して優先順位付きアクションプランを生成**

活用方法：
1. 複数のL2ツールを同時実行
2. 問題を重複排除して集約
3. 影響度と実装難易度で優先順位付け
4. 実装可能なアクションプランを生成

最適な使用シナリオ：
- 初回のパフォーマンス改善計画
- 定期的な改善レビュー
- チーム向けのタスク生成

#### 💰 l3_performance_budget
**パフォーマンス予算の設定と監視**

活用方法：
1. 目標メトリクスの設定
2. 現状との差分分析
3. 予算超過の警告
4. 改善提案の生成

最適な使用シナリオ：
- CI/CDでの自動チェック
- 定期的な予算遵守確認
- リグレッション防止

#### 🔍 l3_pattern_insights
**パターン認識による洞察生成**

活用方法：
1. 複数ページ/サイトのパターン分析
2. 共通問題の特定
3. ベストプラクティスの抽出
4. 改善パターンの提案

最適な使用シナリオ：
- 大規模サイトの分析
- 複数プロジェクトの比較
- 組織全体の改善戦略

---

## 分析ワークフローの例

### 1. 初回分析フロー

```
1. l1_collect_single (データ収集)
   ↓
2. l2_deep_analysis (包括的分析)
   ↓
3. l2_weighted_issues (優先順位付け)
   ↓
4. l3_action_plan_generator (アクションプラン生成)
```

### 2. 特定問題の深堀りフロー

```
LCPが遅い場合：
1. l2_lcp_chain_analysis (LCP要因分析)
2. l2_critical_chain (依存関係分析)
3. l2_third_party_impact (サードパーティ影響確認)
```

### 3. 継続的モニタリングフロー

```
1. l1_batch_collect (複数URL収集)
   ↓
2. l2_site_comparison (比較分析)
   ↓
3. l3_performance_budget (予算チェック)
   ↓
4. l3_pattern_insights (傾向分析)
```

---

## まとめ

- **包括的分析**: `l2_deep_analysis`から始める
- **特定問題**: 専門ツールで深堀り
- **優先順位**: `l2_weighted_issues`で判断
- **アクションプラン**: `l3_action_plan_generator`で生成
- **継続的改善**: L3ツールで戦略立案

各ツールは特定の問題に特化しており、組み合わせることで効果的なパフォーマンス改善が可能です。